{"version":3,"sources":["C:\\Users\\A.P\\OneDrive\\Desktop\\echo-main\\frontend\\src\\components\\auth\\__tests__\\OTPInput.simple.test.tsx"],"sourcesContent":["/**\r\n * Simple OTPInput Component Tests\r\n * Basic functionality tests without complex dependencies\r\n */\r\n\r\nimport React from 'react';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport OTPInput from '@/components/auth/OTPInput';\r\n\r\n// Mock framer-motion to avoid animation issues in tests\r\njest.mock('framer-motion', () => ({\r\n  motion: {\r\n    div: ({ children, ...props }: any) => <div {...props}>{children}</div>,\r\n    p: ({ children, ...props }: any) => <p {...props}>{children}</p>,\r\n  },\r\n}));\r\n\r\ndescribe('OTPInput - Basic Functionality', () => {\r\n  const user = userEvent.setup();\r\n  const mockOnComplete = jest.fn();\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('Component Rendering', () => {\r\n    it('renders correct number of input fields', () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      expect(inputs).toHaveLength(6);\r\n    });\r\n\r\n    it('renders with custom length', () => {\r\n      render(<OTPInput length={4} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      expect(inputs).toHaveLength(4);\r\n    });\r\n\r\n    it('shows loading state', () => {\r\n      render(\r\n        <OTPInput length={6} onComplete={mockOnComplete} loading={true} />\r\n      );\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      inputs.forEach((input) => {\r\n        expect(input).toBeDisabled();\r\n      });\r\n\r\n      expect(screen.getByText('Verifying...')).toBeInTheDocument();\r\n    });\r\n\r\n    it('shows error state', () => {\r\n      render(\r\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid OTP\" />\r\n      );\r\n\r\n      expect(screen.getByText('Invalid OTP')).toBeInTheDocument();\r\n      expect(screen.getByRole('alert')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Input Behavior', () => {\r\n    it('accepts only numeric input', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const firstInput = screen.getAllByRole('textbox')[0];\r\n\r\n      await user.type(firstInput, 'a');\r\n      expect(firstInput).toHaveValue('');\r\n\r\n      await user.type(firstInput, '1');\r\n      expect(firstInput).toHaveValue('1');\r\n    });\r\n\r\n    it('moves to next input after entering digit', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n\r\n      await user.type(inputs[0], '1');\r\n      expect(inputs[1]).toHaveFocus();\r\n    });\r\n\r\n    it('handles backspace navigation', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n\r\n      // Type in first input and move to second\r\n      await user.type(inputs[0], '1');\r\n      expect(inputs[1]).toHaveFocus();\r\n\r\n      // Backspace should move back to first input\r\n      await user.keyboard('{Backspace}');\r\n      expect(inputs[0]).toHaveFocus();\r\n    });\r\n\r\n    it('replaces existing digit when typing', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const firstInput = screen.getAllByRole('textbox')[0];\r\n\r\n      await user.type(firstInput, '1');\r\n      expect(firstInput).toHaveValue('1');\r\n\r\n      // Clear and type new digit\r\n      await user.clear(firstInput);\r\n      await user.type(firstInput, '2');\r\n      expect(firstInput).toHaveValue('2');\r\n    });\r\n  });\r\n\r\n  describe('Completion Handling', () => {\r\n    it('calls onComplete when all fields are filled', async () => {\r\n      render(<OTPInput length={4} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n\r\n      await user.type(inputs[0], '1');\r\n      await user.type(inputs[1], '2');\r\n      await user.type(inputs[2], '3');\r\n      await user.type(inputs[3], '4');\r\n\r\n      await waitFor(() => {\r\n        expect(mockOnComplete).toHaveBeenCalledWith('1234');\r\n      });\r\n    });\r\n\r\n    it('does not call onComplete for incomplete OTP', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n\r\n      await user.type(inputs[0], '1');\r\n      await user.type(inputs[1], '2');\r\n      await user.type(inputs[2], '3');\r\n\r\n      expect(mockOnComplete).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Accessibility', () => {\r\n    it('has proper ARIA attributes', () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      inputs.forEach((input, index) => {\r\n        expect(input).toHaveAttribute('aria-label', `Digit ${index + 1} of 6`);\r\n        expect(input).toHaveAttribute('inputMode', 'numeric');\r\n      });\r\n    });\r\n\r\n    it('supports screen readers with live region', () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const liveRegion = screen.getByRole('status');\r\n      expect(liveRegion).toHaveAttribute('aria-live', 'polite');\r\n      expect(liveRegion).toHaveAttribute('aria-atomic', 'true');\r\n    });\r\n\r\n    it('announces errors to screen readers', () => {\r\n      render(\r\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid OTP\" />\r\n      );\r\n\r\n      const errorElement = screen.getByText('Invalid OTP');\r\n      expect(errorElement).toHaveAttribute('role', 'alert');\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('handles focus events correctly', async () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n\r\n      // Focus on middle input\r\n      inputs[2].focus();\r\n      expect(inputs[2]).toHaveFocus();\r\n\r\n      // Type should work from any focused input\r\n      await user.type(inputs[2], '5');\r\n      expect(inputs[2]).toHaveValue('5');\r\n    });\r\n\r\n    it('handles loading state correctly', () => {\r\n      render(\r\n        <OTPInput length={6} onComplete={mockOnComplete} loading={true} />\r\n      );\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      inputs.forEach((input) => {\r\n        expect(input).toBeDisabled();\r\n      });\r\n\r\n      expect(screen.getByText('Verifying...')).toBeInTheDocument();\r\n    });\r\n\r\n    it('handles error state correctly', () => {\r\n      render(\r\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid code\" />\r\n      );\r\n\r\n      expect(screen.getByText('Invalid code')).toBeInTheDocument();\r\n      expect(screen.getByRole('alert')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Security', () => {\r\n    it('does not expose OTP in DOM attributes', () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      inputs.forEach((input) => {\r\n        expect(input).not.toHaveAttribute('data-value');\r\n        expect(input).not.toHaveAttribute('title');\r\n      });\r\n    });\r\n\r\n    it('uses proper input mode for numeric input', () => {\r\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\r\n\r\n      const inputs = screen.getAllByRole('textbox');\r\n      inputs.forEach((input) => {\r\n        expect(input).toHaveAttribute('inputMode', 'numeric');\r\n        expect(input).toHaveAttribute('maxLength', '1');\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"names":["jest","mock","motion","div","children","props","p","describe","user","userEvent","setup","mockOnComplete","fn","beforeEach","clearAllMocks","it","render","OTPInput","length","onComplete","inputs","screen","getAllByRole","expect","toHaveLength","loading","forEach","input","toBeDisabled","getByText","toBeInTheDocument","error","getByRole","firstInput","type","toHaveValue","toHaveFocus","keyboard","clear","waitFor","toHaveBeenCalledWith","not","toHaveBeenCalled","index","toHaveAttribute","liveRegion","errorElement","focus"],"mappings":"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"}