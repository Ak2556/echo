{"version":3,"sources":["/Users/aena/Developer/echo/frontend/src/components/auth/__tests__/OTPInput.simple.test.tsx"],"sourcesContent":["/**\n * Simple OTPInput Component Tests\n * Basic functionality tests without complex dependencies\n */\n\nimport React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport OTPInput from '@/components/auth/OTPInput';\n\n// Mock framer-motion to avoid animation issues in tests\njest.mock('framer-motion', () => ({\n  motion: {\n    div: ({ children, ...props }: any) => <div {...props}>{children}</div>,\n    p: ({ children, ...props }: any) => <p {...props}>{children}</p>,\n  },\n}));\n\ndescribe('OTPInput - Basic Functionality', () => {\n  const user = userEvent.setup();\n  const mockOnComplete = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Component Rendering', () => {\n    it('renders correct number of input fields', () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n      expect(inputs).toHaveLength(6);\n    });\n\n    it('renders with custom length', () => {\n      render(<OTPInput length={4} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n      expect(inputs).toHaveLength(4);\n    });\n\n    it('shows loading state', () => {\n      render(\n        <OTPInput length={6} onComplete={mockOnComplete} loading={true} />\n      );\n\n      const inputs = screen.getAllByRole('textbox');\n      inputs.forEach((input) => {\n        expect(input).toBeDisabled();\n      });\n\n      expect(screen.getByText('Verifying...')).toBeInTheDocument();\n    });\n\n    it('shows error state', () => {\n      render(\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid OTP\" />\n      );\n\n      expect(screen.getByText('Invalid OTP')).toBeInTheDocument();\n      expect(screen.getByRole('alert')).toBeInTheDocument();\n    });\n  });\n\n  describe('Input Behavior', () => {\n    it('accepts only numeric input', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const firstInput = screen.getAllByRole('textbox')[0];\n\n      await user.type(firstInput, 'a');\n      expect(firstInput).toHaveValue('');\n\n      await user.type(firstInput, '1');\n      expect(firstInput).toHaveValue('1');\n    });\n\n    it('moves to next input after entering digit', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n\n      await user.type(inputs[0], '1');\n      expect(inputs[1]).toHaveFocus();\n    });\n\n    it('handles backspace navigation', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n\n      // Type in first input and move to second\n      await user.type(inputs[0], '1');\n      expect(inputs[1]).toHaveFocus();\n\n      // Backspace should move back to first input\n      await user.keyboard('{Backspace}');\n      expect(inputs[0]).toHaveFocus();\n    });\n\n    it('replaces existing digit when typing', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const firstInput = screen.getAllByRole('textbox')[0];\n\n      await user.type(firstInput, '1');\n      expect(firstInput).toHaveValue('1');\n\n      // Clear and type new digit\n      await user.clear(firstInput);\n      await user.type(firstInput, '2');\n      expect(firstInput).toHaveValue('2');\n    });\n  });\n\n  describe('Completion Handling', () => {\n    it('calls onComplete when all fields are filled', async () => {\n      render(<OTPInput length={4} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n\n      await user.type(inputs[0], '1');\n      await user.type(inputs[1], '2');\n      await user.type(inputs[2], '3');\n      await user.type(inputs[3], '4');\n\n      await waitFor(() => {\n        expect(mockOnComplete).toHaveBeenCalledWith('1234');\n      });\n    });\n\n    it('does not call onComplete for incomplete OTP', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n\n      await user.type(inputs[0], '1');\n      await user.type(inputs[1], '2');\n      await user.type(inputs[2], '3');\n\n      expect(mockOnComplete).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Accessibility', () => {\n    it('has proper ARIA attributes', () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n      inputs.forEach((input, index) => {\n        expect(input).toHaveAttribute('aria-label', `Digit ${index + 1} of 6`);\n        expect(input).toHaveAttribute('inputMode', 'numeric');\n      });\n    });\n\n    it('supports screen readers with live region', () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const liveRegion = screen.getByRole('status');\n      expect(liveRegion).toHaveAttribute('aria-live', 'polite');\n      expect(liveRegion).toHaveAttribute('aria-atomic', 'true');\n    });\n\n    it('announces errors to screen readers', () => {\n      render(\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid OTP\" />\n      );\n\n      const errorElement = screen.getByText('Invalid OTP');\n      expect(errorElement).toHaveAttribute('role', 'alert');\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('handles focus events correctly', async () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n\n      // Focus on middle input\n      inputs[2].focus();\n      expect(inputs[2]).toHaveFocus();\n\n      // Type should work from any focused input\n      await user.type(inputs[2], '5');\n      expect(inputs[2]).toHaveValue('5');\n    });\n\n    it('handles loading state correctly', () => {\n      render(\n        <OTPInput length={6} onComplete={mockOnComplete} loading={true} />\n      );\n\n      const inputs = screen.getAllByRole('textbox');\n      inputs.forEach((input) => {\n        expect(input).toBeDisabled();\n      });\n\n      expect(screen.getByText('Verifying...')).toBeInTheDocument();\n    });\n\n    it('handles error state correctly', () => {\n      render(\n        <OTPInput length={6} onComplete={mockOnComplete} error=\"Invalid code\" />\n      );\n\n      expect(screen.getByText('Invalid code')).toBeInTheDocument();\n      expect(screen.getByRole('alert')).toBeInTheDocument();\n    });\n  });\n\n  describe('Security', () => {\n    it('does not expose OTP in DOM attributes', () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n      inputs.forEach((input) => {\n        expect(input).not.toHaveAttribute('data-value');\n        expect(input).not.toHaveAttribute('title');\n      });\n    });\n\n    it('uses proper input mode for numeric input', () => {\n      render(<OTPInput length={6} onComplete={mockOnComplete} />);\n\n      const inputs = screen.getAllByRole('textbox');\n      inputs.forEach((input) => {\n        expect(input).toHaveAttribute('inputMode', 'numeric');\n        expect(input).toHaveAttribute('maxLength', '1');\n      });\n    });\n  });\n});\n"],"names":["jest","mock","motion","div","children","props","p","describe","user","userEvent","setup","mockOnComplete","fn","beforeEach","clearAllMocks","it","render","OTPInput","length","onComplete","inputs","screen","getAllByRole","expect","toHaveLength","loading","forEach","input","toBeDisabled","getByText","toBeInTheDocument","error","getByRole","firstInput","type","toHaveValue","toHaveFocus","keyboard","clear","waitFor","toHaveBeenCalledWith","not","toHaveBeenCalled","index","toHaveAttribute","liveRegion","errorElement","focus"],"mappings":"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"}